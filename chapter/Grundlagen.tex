\chapter{\label{chap:grundlagen}Grundlagen}
Dieses Kapitel befasst sich mit sowohl den mathematischen als auch den technischen Grundlagen der zu behandelnden Thematik, welche für das weitere Verständnis der Arbeit beitragen.
% -------------------------------------------------
% TECHNISCHE GRUNDLAGEN
% -------------------------------------------------
\section{\label{sec:technGrundlagen}Technische Grundlagen}
Im Zuge dieser Arbeit wird eine Smartphone Anwendung erstellt, deren Grundlage für die Implementierung die Software-Plattform Android und der im \gls{Smartphone} integrierte \gls{GPS}-Sensor ist. Die eigene Position und Geschwindigkeit wird mittels \gls{GPS} ermittelt, um in Verbindung mit der festen Position der nächsten \gls{LSA} die optimale Geschwindigkeit für das Erreichen der "'Grünen Welle"' zu errechnen. Im folgenden Abschnitt werden Funktionsweise und Besonderheiten der verwendeten Technologien beschrieben. 
% ANDROID
\subsection{Android}
Die umfassende Open-Source-Plattform Android stellt eine vollständige Ausstattung für Mobilgeräte dar. Android-Anwendungen werden mit der Programmiersprache Java und der Auszeichnungssprache \gls{XML} entwickelt. Mit dem Android \gls{SDK}\footnote{ Das Android \gls{SDK} steht unter \url{https://developer.android.com/sdk/index.html} zum Download bereit} werden die Werkzeuge und \gls{API} zur Verfügung gestellt, die erforderlich sind Mobilanwendungen auf der Android-Plattform erzeugen zu können.\\ 
Zu den wichtigsten \gls{SDK} Werkzeugen gehören der Android \gls{SDK}-Manager, der AVD-Manager, der Emulator und der Dalvik Debug Monitor Server(Ddms). Der \gls{SDK}-Manager verwaltet die \gls{SDK}-Pakete, sowie die installierten Pakete und System-Images. Der AVD-Manager bietet eine grafische Oberfläche in der Android Virtuell Devices verwaltet, und im Emulator ausgeführt werden können. Mithilfe des Ddms können Android Anwendungen auf Fehler untersucht werden. \cite{android_sdk} \\\\
Mit dem Android \gls{NDK}\footnote{ Das Android \gls{NDK} steht unter \url{https://developer.android.com/tools/sdk/ndk/index.html} zum Download bereit} existiert auch ein Tool, mit dem Teile einer Anwendung in systemeigenen Programmiersprachen wie C oder C++ implementiert werden können. Programmcode der in solchen Sprachen geschrieben ist, eignet sich zum Beispiel bei CPU-intensiven Operationen wie Signalverarbeitungen oder Physik-Simulationen besonders gut. Hier ist allerdings sicherzustellen, ob die erforderlichen Bibliotheken in dem \gls{SDK} auch verfügbar sind. \cite{android_ndk} \\
Einen Überblick über die komplexe Android-Systemarchitektur, welche nachfolgend (nach \cite{android} S. 3ff) kurz beschrieben wird, zeigt die folgende Abbildung.
\begin{figure}[H]  
    \centering  
    \includegraphics[width=0.7\textwidth]{Android-System-Architecture} 
    \caption[Android-Systemarchitektur]{Die Android-Systemarchitektur Quelle: \url{http://en.wikipedia.org/wiki/File:Android-System-Architecture.svg}}
    \label{fig:android}
\end{figure}
\paragraph{Linux Kernel: }
Android basiert auf dem Linux 3.1-Kernel. Dieser eine bewährte Betriebssystemgrundlage indem er die erforderlichen Hardware-Treiber zur Verfügung stellt.
\paragraph{Bibliotheken: }
Systemeigenen Bibliotheken sind C/C++ Bibliotheken und vorinstalliert. Dazu gehören alle Bibliotheken im grünen Bereich von Abbildung \ref{fig:android}:
\begin{itemize}[leftmargin=0.7cm]
\renewcommand\labelitemi{--}
	\item \textsc{Surface Manager} ~ Der für die Displayverwaltung verantwortliche Oberflächen-Manager
	\item \textsc{OpenGL/ES} ~ Eine 2D und 3D Grafikbibliothek
	\item \textsc{SGL} ~ Eine 2D Grafikbibliothek
 	\item \textsc{Media-Framework} ~ eine Medien-Bibliothek zur Wiedergabe von Audio- und Video-Daten 	
 	\item \textsc{FreeType} ~ eine Bibliothek zur Darstellung von Computerschriften als Rastergrafik
 	\item \textsc{SSL} ~ Das Secure-Socket-Layer für die Internet-Sicherheit
	\item \textsc{SQLite} ~ Ist eine ausgereifte Datenbank die den internen Gerätespeicher nutzt 
	\item \textsc{Webkit} ~ WebKit ist die Standard-Browser-Engine und erlaubt das schnelle Rendern und Anzeigen von HTML Seiten
	\item \textsc{libc} ~ Eine C-Bibliothek
\end{itemize}
\paragraph{Android Runtime: }
Die Android Laufzeitumgebung nutzt die Java-Core-Bibliotheken und die Dalvik \gls{VM}, welche noch auf der Grafik abgebildet ist. Diese wurde mit der Version 5.0 durch die Android Runtime (ART) ersetzt\cite{android_5}
\paragraph{Application Framework: }
Androids Application-Framework ist eine Umgebung die unterschiedliche Dienste zur Verfügung stellt. Sie bietet EntwicklerInnen Zugriff auf die im Kern verwendeten \glspl{API} sowie auf die Java-Bibliotheken die für Android erstellt wurden. 
\paragraph{Applications: }
Auf der obersten Ebene in Abbildung \ref{fig:android} befinden sich die Anwendungen die den täglichen Telefon-Bedarfs wie Adressbuch, Messenger, E-Mail, Internet-Browser etc. decken. Zusätzlich unterstützt Android verschiedene Anwendungen von Drittanbietern. Diese sind hauptsächlich in Java geschrieben und werden am häufigsten über den Google Play Store verteilt.
% RELATIONALE DATENBANKEN
\subsection{Relationale Datenbanken}
Eine relationale Datenbank dient der elektronischen Verwaltung von Daten. Die Organisation der Daten ist tabellenbasiert, erfolgt also in Form von Datenstrukturen mit Zeilen (Tupel) und Spalten (Attribute). Jedes Tupel einer Tabelle bildet den sogenannten Datensatz und setzt sich aus den Werten mehrerer Attribute zusammen. Ein Tupel ist über einen oder mehrere Schlüssel eindeutig identifizierbar. Die Daten in einzelnen Tabellen lassen sich über die Schlüssel verknüpfen und weisen dadurch Relationen, also Beziehungen der Attribute zum Tupel, auf. \\
Für die Kommunikation mit relationalen Datenbanken wie SQLite gibt es die Datenbanksprache \gls{SQL}. Mit SQLite können via \gls{SQL} folgende Operationen durchgeführt werden:
\begin{itemize}[leftmargin=0.7cm]
\renewcommand\labelitemi{--}
	\item Definition der Datenstruktur
	\item Anlegen und Löschen einer Tabelle
	\item Bearbeiten (Einfügen, Verändern, Löschen) von Tupeln
	\item Suchen von Daten aus einer oder mehreren Tabellen
\end{itemize}
%Die meisten dieser Operationen lassen sich allerdings auch ohne Rückgriff auf \gls{SQL} umsetzen. 
% SQLITE %
\subsubsection{SQLite}
SQLite ist eine Datenbank-Engine die auch bei Android sehr beliebt ist. Es benötigt nur minimale Unterstützung von externen Bibliotheken oder vom Betriebssystem. So eignet es sich gut für den Einsatz in Systemen, denen die Infrastruktur eines Desktop-Computers fehlt. Der Code ist Open Source und frei für den privaten oder gewerblichen Einsatz.\\
Als sehr kompakte Bibliothek ist sie mit allen aktivierten Funktionen immernoch kleiner als 500 kB. Mit der Weglassung optionaler Merkmale kann die Größe auf circa 300 kB Speicherplatz reduziert werden, was jedoch SQLite verlangsamt. Denn es ist umso schneller je mehr Speicherkapazität zur Verfügung steht.
Im Gegensatz zu den meisten anderen \gls{SQL}-Datenbanken ist keine Client-Server-Architektur vorhanden. Um in die Datenbank zu schreiben oder daraus zu lesen greift der Prozess auf die interne Festplatte, und nicht auf einen Server zu. Es ist also keine Netzwerverbindung vonnöten. \\
Der Hauptvorteil, keinen separaten Serverprozess zu installieren, einzurichten, zu konfigurieren und zu verwalten, macht SQLite zu einem konfigurationsfreien Datenbanksystem. Es besteht keine administrative Notwendigkeit um eine neue Datanbankinstanz zu erstellen oder Zugriffsrechte zuzuweisen. 
\begin{center}
\textit{\color{gray}"'SQLite just works."'}\hspace{9pt}\cite{sqlitea}
\end{center}
Als Transaktionsdatenbank implementiert SQLite serialisierbare Transaktionen die auch bei einem Programm- oder Betriebssystemabsturz atomar, konsistent, isoliert und dauerhaft sind. Wird also die Transaktion durch z.B. einen Programmabsturz unterbrochen, werden alle Änderungen entweder gar nicht oder komplett angezeigt.\\ 
SQLite ist außerdem eine Ein-Datei-Datenbank. Das bedeutet die vollständige \gls{SQL}-Datenbank mit mehreren Tabellen, Indizes und Ansichten wird in nur einer Datei gespeichert. So kann jedes Programm, das in der Lage ist auf die Festplatte zuzugreifen, die SQLite-Datenbank verwenden. \cite{sqlite} Aufgrund eben dieser Eigenschaften eignet sich SQLite ausgezeichnet für die Entwicklung von Android-\glspl{App}.
% SQLITE ANDROID %
\subsubsection{SQLite unter Android}
Android stellt mit dem Paket \texttt{android.database.sqlite} eine \gls{API} zur Verfügung, die den effektiven Einsatz von SQLite ermöglicht. Dort findet sich die Hilfsklasse \texttt{SQLiteOpener}, welche eine Instanz von \texttt{SQLiteDataBase} liefert. Der Konstruktor der Hilfsklasse erwartet ein Context-Objekt und den Namen der Datenbank. Beim Aufruf der geerbten Methoden \texttt{getReadableDatabase()} zum Datenauslesen oder \texttt{getWritableDatabase()} zum Verändern oder auslesen der Daten wird geprüft, ob eine Datenbank mit diesem Namen bereits existiert. Ist das der Fall erhält man eine Referenz auf Datenbankobjekt, wenn nicht wird eines erstellt.\\
Wird eine Datenbank neu angelegt, geschieht das durch den Aufruf der \texttt{onCreate()} Methode. Hier wird ein \gls{SQL}-String erstellt, der den Tabellennamen und die enthaltenden Spalten angibt. Dieser String wird via \texttt{execSQL()} dem \texttt{SQLite-Database}-Objekt gegeben, in Folge dessen eine Tabellenstruktur angelegt wird.\\
% --------------------------CODE ----------------------------------------------------%
\lstinputlisting
[caption={Anlegen einer Tabellenstruktur}
\label{code:onCreate}, captionpos=b, language=JAVA]{code/onCreate.java}
% --------------------------CODE ----------------------------------------------------%
 Im obigen Codebeispiel soll eine Tabelle namens \textit{schiffe} mit den vier Spalten \textit{id}, \textit{bezeichnung}, \textit{captain} und \textit{geburtstatum} mit den entsprechenden Datentypen angelegt werden. Die Spalte \textit{id} fungiert hier als Primärschlüssel, kann also zur eindeutigen Referenzierung der Datensätze verwendet werden. Mit der Angabe von \textsc{autoincrement} setzt SQLite automatisch die nächste verfügbare ID als Wert ein. Die Datensätze ohne den Zusatz \textsc{not null} sind nicht obligatorisch.\\
Jede SQLite-Datenbank die in einer \gls{App} erzeugt wird, wird auch dort abgelegt. So ist sie auch nur für die Anwendung zugreifbar, die sie angelegt hat. Zu erwähnen ist noch, dass der Umfang der Datenbank die interne Speicherkapazität nicht überschreiten kann. Hat man die Datenbank erfolgreich erstellt, lassen sich die vier CRUD\footnote{ Create, Read, Update, Delete} Operationen darauf anwenden. Hierfür wird die entsprechende Methode mit den gewünschten Kriterien auf die Instanz der Datenbank angewandt.
% MOBILE SENSING
\subsection{Mobile Sensorik} 
Ein Sensor\footnote{ aus dem Lateinischen, deutsch: "'\textit{fühlen}"'} ist ein Bauelement, das physikalische Eigenschaften wie Helligkeit, Temperatur oder Beschleunigung sowohl quantitativ als auch qualitativ erfassen kann.
Die \gls{GPS}-Sensoren in \glspl{Smartphone} sind kostengünstiger, kleiner und haben einen geringeren Stromverbrauch. Dafür allerdings eine geringere Messgenauigkeit. In der zu entwickelnden Anwendung kommt es auf jeden Meter an. Ob die Genauigkeit des integrierten \gls{GPS}-Sensors genügt, muss also im Rahmen dieser Arbeit getestet werden. 
% MOBILE SENSORIK UNTER ANDROID %
\subsubsection{Mobile Sensorik unter Android}
Die meisten Android-Mobilgeräte verfügen über integrierte Sensoren, die die Bewegung, Ausrichtung und verschiedene Umgebungsbedingungen messen. Diese Sensoren sind praktisch wenn man dreidimensionale Gerätbewegungen, Positionierungen oder Änderungen in der Umgebung des Gerätes überwachen möchte. So können zum Beispiel Spieleanwendungen den Beschleunigungssensor nutzen, um komplexe BenutzerInnengesten und Bewegungen wie Neigung, Erschütterung, Drehung oder Schwenkung erfassen.\\
Die Android-Plattform unterstützt Bewegungssensoren zum Messen von Beschleunigungen und Drehungen in drei Achsen, Umgebungssensoren zur Ermittlung verschiedener Umweltparameter wie Luftdruck und -feuchtigkeit, oder Beleuchtung und Temperatur, und Positionssensoren zum Messen der physikalischen Position des Gerätes. Android bietet mit dem Android Sensor Framework eine Sammlung von Klassen und Schnittstellen an mithilfe dessen man auf diese Sensoren zugreifen und deren Daten erfassen kann. \cite{android_sensor} 
% GEOLOKATION BLUETOOTH NFC
\subsubsection{Geolokation mittels Network Porvider}
% GEOLIKATION GPS %
\subsubsection{Geolokation mittels \gls{GPS}}
Die satellitengestützte Positionsbestimmung \gls{GPS} gewährleistet die Bestimmung des exakten Standpunktes und ist so wesentlicher Bestandteil ortsgebundener Anwendungen wie zum Beispiel die in Kapitel \ref{chap:state} beschriebenen. \\
\gls{GPS} wurde ursprünglich vom US-Militär entwickelt und dann Mitte der 90er Jahre der Öffentlichkeit zur Verfügung gestellt. Noch heute bleibt es mit einer Genauigkeit von bis zu vier Metern die genaueste Lokalisierungstechnologie. Das Globale Positionsbestimmungssystem bestimmt mittels 31 Satelliten die die Erde umkreisen und ihre aktuelle Position mit der genauen Uhrzeit ausstrahlen. Daraus errechnet ein \gls{GPS}-Empfänger die eigene Position. Daten von einem einzigen Satelliten lässt die Position des \gls{GPS}-Empfängers auf deinen großen Bereich der Erde einschränken. Das Hinzufügen eines zweiten engt die Position auf den Bereich, in dem sich die zwei Bereiche überlappen ein. Mit den Daten eines dritten Satelliten bekommt man bereits eine relativ genaue Positionierung. Mit jedem weiteren Satelliten wird die Präzision erhöht. \gls{GPS}-Empfänger benutzen regelmäßig vier bis sieben, oder gar mehr Satelliten. Trotzdem hat \gls{GPS} einige Nachteile. Es verbraucht viel Energie, was die Akkulaufzeit des Mobiltelefons beeinträchtigt und benötigt nach dem Kaltstart eine Weile, den ersten Satelliten zu erreichen. (\cite{gps} S. 24ff )
\subsubsection{\gls{GPS} unter Android}
Android unterstützt mit dem \texttt{android.location} Paket den Zugriff auf die Ortungsdienste. Als zentrale Komponente des Location Frameworks stellt der \texttt{LocationManager} \glspl{API} zur Lokalisierung des Geräts bereit. Mit dem \texttt{LocationManager} ist die Anwendung in der Lage alle Location Provider\footnote{ deutsch: Standortanbieter. Ein Standortanbieter bietet regelmäßige Berichte über die geographische Lage des Gerätes} des letzten bekannten Standortes abzufragen, sich für regelmäßige Updates zur Position des Gerätes anzumelden und sich wieder abzumelden wenn sich das Gerät außerhalb gegebener Parameter befindet. \cite{android_gps} \\
Die geographische Positionsangabe besteht aus Längengrad (Langitude) und Breitengrad (Lotitude). Beide werden unter anderem vom \texttt{LocationManager}-Objekt als Gleitkommawert geliefert. Daneben auch Informationen wie die Höhe in Metern über der Mehreshöhe, Peilung, Zeitstempel und die Geschwindigkeit.
\clearpage
% -------------------------------------------------
% MATHEMATISCHE GRUNDLAGEN
% -------------------------------------------------
\section{\label{sec:mathGrundlagen}Berechnung der Geschwindigkeitsempfehlung}
Präsentiert das System während der Anwendung eine Geschwindigkeitsempfehlung, ist diese abhängig von der Fahrgeschwindigkeit und vom Abstand zur Ampel. Für einen Streckenabschnitt zwischen zwei Punkten (Position der Ampel und Position der Rades) wird die Zeitspanne $\Delta t$ benötigt. Diese errechnet man mit $t_{2} - t_{1}$, woraus sich dann die Durchschnittsgeschwindigkeit im untersuchten Streckenabschnitt ergibt.\\ 
Angenommen die Progressionsgeschwindigkeit $v$ wird zum Zeitpunkt $t_{1}$ ermittelt, die \gls {LSA} schaltet zum Zeitpunt $t_{2}$ auf Rot und Abstand zur Ampel beträgt $s$, dann gilt: \\
\[ v = \frac{s}{t_{2} - t_{1}} \] \\
Der Abstand zur Ampel wird also durch die verbleibende Zeit dividiert. 
Die von der Berliner Verkehrsleitzentrale zur Verfügung gestellten Ampelsignalpläne und Position der angesteuerten Ampel dienen als Grundlage dieser Berechnung und sind aus der Datenbank zu holen. Die aktuelle Position des Fahrrads wird vom \gls{GPS} Sensor des \glspl{Smartphone} ermittelt und daraus der Abstand zur Ampel errechnet. Die Abbildung \ref{fig:vst} soll die Berechnungsgrundlagen veranschaulichen: 
\begin{figure}[H]  
    \centering  
    \includegraphics[width=1\textwidth]{vst}     
    \caption[Berechnung Progressionsgeschwindigkeit]{Veranschaulichung der Berechnung}
    \label{fig:vst}
\end{figure}
Um die ensprechende \gls{LSA} während der Grünphase zu passieren, muss letztendlich die empfohlene Geschwindigkeit $v$ eingehalten werden.
